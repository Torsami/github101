{"version":3,"sources":["../src/signUp.js"],"names":["app","use","bodyParser","json","urlencoded","extended","text","type","pool","pg","Pool","user","host","database","password","port","signUp","req","res","body","email","username","verify","mailformat","replace","toLowerCase","status","send","success","message","field","match","query","err","result","rows","length","db","bcrypt","hash","Date"],"mappings":"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","file":"signUp.js","sourcesContent":["import pg from 'pg';\r\nimport bcrypt from 'bcryptjs';\r\nimport express from 'express';\r\nimport bodyParser from 'body-parser';\r\n\r\nconst app = express();\r\n\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.urlencoded({ extended: false }));\r\napp.use(bodyParser.text());                                    \r\napp.use(bodyParser.json({ type: 'application/json'})); \r\n\r\nconst pool = new pg.Pool({\r\n    user: 'samipostgres',\r\n    host: '127.0.0.1',\r\n    database: 'mydatabase',\r\n    password: 'samipostgres',\r\n    port: '5432'});\r\n\r\n\r\nconst signUp = (req, res) => {\r\n\r\n\r\nlet {email, username, password, verify} = req.body;\r\nlet mailformat = /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/;\r\nusername = username.replace(/[^0-9A-Za-z\\,]/g, \"\").toLowerCase();\r\n\r\nif(username === ''){\r\n    return res.status(400).send({\r\n        success: `false`,\r\n        message: `All fields are required`,\r\n        field: `username`\r\n    })\r\n}\r\n\r\nif(!email.match(mailformat)){\r\n    return res.status(400).send({\r\n        success: `false`,\r\n        message: `Enter a valid email`,\r\n        field: `email`\r\n    })\r\n}\r\n\r\nif(password === ''){\r\n    return res.status(400).send({\r\n        success: `false`,\r\n        message: `All fields are required`,\r\n        field: `password`\r\n    })\r\n}\r\n\r\nif(verify === ''){\r\n    return res.status(400).send({\r\n        success: `false`,\r\n        message: `All fields are required`,\r\n        field: `verify`\r\n    })\r\n}\r\n\r\npool.query('SELECT * FROM users WHERE (email = $1 OR username = $2)', [email, username], (err, result) => {\r\n    \r\n    if(result.rows.length > 0){\r\n        const db = result.rows[0];\r\n\r\n        if(db.username === username){\r\n            return res.status(400).send({\r\n                success: `false`,\r\n                message: `Username already taken by another user`,\r\n                field: `username`\r\n            })\r\n        }\r\n  \r\n        if(db.email === email){\r\n            return res.status(400).send({\r\n                success: 'false',     \r\n                message: 'Email is associated with another user',\r\n                field: `email`\r\n            }); \r\n        }\r\n\r\n    }else{\r\n        if(password !== verify){\r\n            return res.status(400).send({\r\n                success: 'false',     \r\n                message: 'Password does not match',\r\n                field: `verify`\r\n            }); \r\n        }\r\n\r\n\r\n        bcrypt.hash(password, 10, (err, hash) => {\r\n            if(err) {\r\n                \r\n                return {\r\n                   success: `false`,\r\n                   message: err\r\n                };\r\n            }else{\r\n                pool.query('INSERT INTO users (email, username, password, signupdate, answers) VALUES($1, $2, $3, $4, $5)', \r\n                [email, username, hash, new Date(), 0], (err, result) => {\r\n                   \r\n                        if(result){\r\n\r\n                            return res.status(201).send({\r\n                                success: `true`,\r\n                                message: `Your Signed up was successful`\r\n                            });\r\n                        }\r\n                });\r\n\r\n                }\r\n        })\r\n    }\r\n\r\n    })\r\n};\r\n\r\nexport default signUp;\r\n"]}